<template>
    <div ref="schema" class="schema">
        <svg viewBox="0 0 1442 1074" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="collectiveintelligence">
                <rect width="1440" height="1073" transform="translate(1 1)" fill="white" />
                <g id="mask_3">
                    <mask
                        id="maskCI0"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="737"
                        y="0"
                        width="705"
                        height="424"
                    >
                        <path
                            id="model_CI3"
                            d="M1441 422.822C1261.02 304.779 1071.42 188.888 873.882 76.9214C828.328 51.1014 782.858 25.7772 737.5 0.954684"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI0)">
                        <path
                            id="model_CI3_bg"
                            d="M1441 422.822C1261.02 304.779 1071.42 188.887 873.882 76.9213C828.328 51.1013 781.858 25.3222 736.5 0.49964"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trailCI_3"
                            d="M1058.35 -20.9999L1341.95 153.527L1138.6 483.969L855 309.442L1058.35 -20.9999Z"
                            fill="url(#paintCI0_radial)"
                        />
                    </g>
                </g>
                <g id="mask_2">
                    <mask
                        id="maskCI1"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="221"
                        y="0"
                        width="1221"
                        height="711"
                    >
                        <path
                            id="model_CI2"
                            d="M1441 710.134C1236.58 564.525 1011.93 421.082 772.088 285.143C585.565 179.422 400.87 84.4813 221.257 0.999862"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI1)">
                        <path
                            id="model_CI2_bg"
                            d="M1441 710.134C1236.58 564.525 1011.93 421.082 772.088 285.143C585.565 179.422 400.87 84.4813 221.257 0.999862"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trailCI_2"
                            d="M429.103 303.671L130.865 155.537L303.465 -191.958L601.702 -43.8253L429.103 303.671Z"
                            fill="url(#paintCI1_radial)"
                        />
                    </g>
                </g>
                <g id="mask_1">
                    <mask
                        id="maskCI2"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="0"
                        y="173"
                        width="1442"
                        height="853"
                    >
                        <path
                            id="model_CI1"
                            d="M1 173.691C212.413 255.13 440.543 362.97 672.699 494.555C967.84 661.841 1230.29 845.285 1441 1024.77"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI2)">
                        <path
                            id="model_CI1_bg"
                            d="M1 173.691C212.413 255.13 440.543 362.97 672.699 494.555C967.84 661.841 1230.29 845.285 1441 1024.77"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trailCI_1"
                            d="M541.506 207.819L829.892 374.319L635.892 710.337L347.506 543.837L541.506 207.819Z"
                            fill="url(#paintCI2_radial)"
                        />
                    </g>
                </g>
                <g :id="`circle_wrapper_${links[0].id}`">
                    <circle :id="`circle_${links[0].id}`" cx="442.5" cy="370.5" r="7.5" fill="#657DA2" />
                </g>
                <g :id="`border_wrapper_${links[0].id}`">
                    <path
                        :id="`border_${links[0].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M442.5 331.491C420.956 331.491 403.491 348.956 403.491 370.5C403.491 392.044 420.956 409.509 442.5 409.509C464.044 409.509 481.509 392.044 481.509 370.5C481.509 348.956 464.044 331.491 442.5 331.491ZM402 370.5C402 348.132 420.132 330 442.5 330C464.868 330 483 348.132 483 370.5C483 392.868 464.868 411 442.5 411C420.132 411 402 392.868 402 370.5Z"
                        fill="#657DA2"
                    />
                </g>

                <g :id="`circle_wrapper_${links[1].id}`">
                    <circle :id="`circle_${links[1].id}`" cx="512.5" cy="144.5" r="7.5" fill="#F4F928" />
                </g>
                <g :id="`border_wrapper_${links[1].id}`">
                    <path
                        :id="`border_${links[1].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M512.5 105.491C490.956 105.491 473.491 122.956 473.491 144.5C473.491 166.044 490.956 183.509 512.5 183.509C534.044 183.509 551.509 166.044 551.509 144.5C551.509 122.956 534.044 105.491 512.5 105.491ZM472 144.5C472 122.132 490.132 104 512.5 104C534.868 104 553 122.132 553 144.5C553 166.868 534.868 185 512.5 185C490.132 185 472 166.868 472 144.5Z"
                        fill="#F4F928"
                    />
                </g>

                <g :id="`circle_wrapper_${links[2].id}`">
                    <circle :id="`circle_${links[2].id}`" cx="965.5" cy="129.5" r="7.5" fill="#19232F" />
                </g>
                <g :id="`border_wrapper_${links[2].id}`">
                    <path
                        :id="`border_${links[2].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M965.5 90.4908C943.956 90.4908 926.491 107.956 926.491 129.5C926.491 151.044 943.956 168.509 965.5 168.509C987.044 168.509 1004.51 151.044 1004.51 129.5C1004.51 107.956 987.044 90.4908 965.5 90.4908ZM925 129.5C925 107.132 943.132 89 965.5 89C987.868 89 1006 107.132 1006 129.5C1006 151.868 987.868 170 965.5 170C943.132 170 925 151.868 925 129.5Z"
                        fill="#19232F"
                    />
                </g>
            </g>
            <defs>
                <radialGradient
                    id="paintCI0_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(956.676 144.221) rotate(31.608) scale(333 194)"
                >
                    <stop stop-color="#19232F" />
                    <stop offset="1" stop-color="#19232F" stop-opacity="0" />
                </radialGradient>
                <radialGradient
                    id="paintCI1_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(515.403 129.923) rotate(-153.587) scale(333 194)"
                >
                    <stop stop-color="#F4F928" />
                    <stop offset="1" stop-color="#F4F928" stop-opacity="0" />
                </radialGradient>
                <radialGradient
                    id="paintCI2_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(444.506 375.828) rotate(30) scale(333 194)"
                >
                    <stop stop-color="#657DA2" />
                    <stop offset="1" stop-color="#657DA2" stop-opacity="0" />
                </radialGradient>
            </defs>
        </svg>
    </div>
</template>
<script>
import { gsap } from 'gsap';
import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
gsap.registerPlugin(MotionPathPlugin);
export default {
    props: {
        links: {
            type: Array,
            required: true
        },
        selected: {
            type: String,
            required: true
        }
    },
    data: () => ({
        tweens: {},
        watcher: null
    }),
    watch: {
        selected(value, oldValue) {
            if (value) {
                this.slowMo(value);
            } else {
                this.resetSpeed(oldValue);
            }
        }
    },
    mounted() {
        this.$nextTick(() => {
            this.initPlanets();
        });
    },
    methods: {
        initPlanets() {
            this.links.forEach((planet, index) => {
                const id = planet.id;
                gsap.set(`#border_${id}`, {
                    scale: 0.25,
                    opacity: 0,
                    transformOrigin: '50% 50%'
                });
            });
        },
        slowMo(id) {
            gsap.killTweensOf([`#border_${id}`, `#circle_${id}`]);
            gsap.to(`#circle_${id}`, {
                duration: 0.8,
                scale: 2.6,
                transformOrigin: '50% 50%'
            });
            gsap.to(`#border_${id}`, {
                duration: 0.5,
                scale: 1,
                opacity: 1,
                transformOrigin: '50% 50%',
                delay: 0.2
            });
        },
        resetSpeed(id, index) {
            gsap.killTweensOf([`#border_${id}`, `#circle_${id}`]);

            gsap.to(`#circle_${id}`, {
                duration: 1,
                scale: 1,
                transformOrigin: '50% 50%'
            });
            gsap.to(`#border_${id}`, {
                duration: 0.5,
                scale: 0.25,
                transformOrigin: '50% 50%',
                opacity: 0
            });
        }
    }
};
</script>
