<template>
    <div ref="schema" class="schema">
        <svg viewBox="0 0 2090 1074" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="collectiveintelligence">
                <rect width="2087" height="1073" transform="translate(1 1)" fill="white" />
                <g id="mask_3">
                    <mask
                        id="maskCI0"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="1385"
                        y="0"
                        width="705"
                        height="424"
                    >
                        <path
                            id="modelCI_3"
                            d="M2089 422.822C1909.02 304.779 1719.42 188.888 1521.88 76.9214C1476.33 51.1014 1430.86 25.7772 1385.5 0.954684"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI0)">
                        <path
                            id="modelCI_3_bg"
                            d="M2089 422.822C1909.02 304.779 1719.42 188.887 1521.88 76.9213C1476.33 51.1013 1429.86 25.3222 1384.5 0.49964"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trail_3"
                            d="M1706.35 -20.9998L1989.95 153.527L1786.6 483.969L1503 309.442L1706.35 -20.9998Z"
                            fill="url(#paintCI0_radial)"
                        />
                    </g>
                </g>
                <g id="mask_2">
                    <mask
                        id="maskCI1"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="869"
                        y="0"
                        width="1221"
                        height="711"
                    >
                        <path
                            id="modelCI_2"
                            d="M2089 710.134C1884.58 564.525 1659.93 421.082 1420.09 285.143C1233.57 179.422 1048.87 84.4813 869.257 0.999862"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI1)">
                        <path
                            id="modelCI_2_bg"
                            d="M2089 710.134C1884.58 564.525 1659.93 421.082 1420.09 285.143C1233.57 179.422 1048.87 84.4813 869.257 0.999862"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trail_2"
                            d="M1077.1 303.671L778.865 155.537L951.465 -191.958L1249.7 -43.8253L1077.1 303.671Z"
                            fill="url(#paintCI1_radial)"
                        />
                    </g>
                </g>
                <g id="mask_1">
                    <mask
                        id="maskCI2"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="0"
                        y="0"
                        width="2090"
                        height="1026"
                    >
                        <path
                            id="modelCI_1"
                            d="M1 1.22665C336.989 37.0982 819.702 210.541 1321.2 494.788C1616.34 662.073 1878.79 845.517 2089.5 1025"
                            stroke="#657DA2"
                        />
                    </mask>
                    <g mask="url(#maskCI2)">
                        <path
                            id="modelCI_1_bg"
                            d="M1 1.22665C336.989 37.0982 819.702 210.541 1321.2 494.788C1616.34 662.073 1878.79 845.517 2089.5 1025"
                            stroke="#657DA2"
                            stroke-opacity="0.4"
                            stroke-width="2"
                        />
                        <path
                            id="trail_1"
                            d="M1189.51 207.819L1477.89 374.319L1283.89 710.337L995.506 543.837L1189.51 207.819Z"
                            fill="url(#paintCI2_radial)"
                        />
                    </g>
                </g>

                <g :id="`circle_wrapper_${links[0].id}`">
                    <circle :id="`circle_${links[0].id}`" cx="1090.5" cy="370.5" r="7.5" fill="#657DA2" />
                </g>
                <g :id="`border_wrapper_${links[0].id}`">
                    <path
                        :id="`border_${links[0].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M1090.5 331.491C1068.96 331.491 1051.49 348.956 1051.49 370.5C1051.49 392.044 1068.96 409.509 1090.5 409.509C1112.04 409.509 1129.51 392.044 1129.51 370.5C1129.51 348.956 1112.04 331.491 1090.5 331.491ZM1050 370.5C1050 348.132 1068.13 330 1090.5 330C1112.87 330 1131 348.132 1131 370.5C1131 392.868 1112.87 411 1090.5 411C1068.13 411 1050 392.868 1050 370.5Z"
                        fill="#657DA2"
                    />
                </g>

                <g :id="`circle_wrapper_${links[1].id}`">
                    <circle :id="`circle_${links[1].id}`" cx="1160.5" cy="144.5" r="7.5" fill="#F4F928" />
                </g>
                <g :id="`border_wrapper_${links[1].id}`">
                    <path
                        :id="`border_${links[1].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M1160.5 105.491C1138.96 105.491 1121.49 122.956 1121.49 144.5C1121.49 166.044 1138.96 183.509 1160.5 183.509C1182.04 183.509 1199.51 166.044 1199.51 144.5C1199.51 122.956 1182.04 105.491 1160.5 105.491ZM1120 144.5C1120 122.132 1138.13 104 1160.5 104C1182.87 104 1201 122.132 1201 144.5C1201 166.868 1182.87 185 1160.5 185C1138.13 185 1120 166.868 1120 144.5Z"
                        fill="#F4F928"
                    />
                </g>

                <g :id="`circle_wrapper_${links[2].id}`">
                    <circle :id="`circle_${links[2].id}`" cx="1613.5" cy="129.5" r="7.5" fill="#19232F" />
                </g>
                <g :id="`border_wrapper_${links[2].id}`">
                    <path
                        :id="`border_${links[2].id}`"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M1613.5 90.4908C1591.96 90.4908 1574.49 107.956 1574.49 129.5C1574.49 151.044 1591.96 168.509 1613.5 168.509C1635.04 168.509 1652.51 151.044 1652.51 129.5C1652.51 107.956 1635.04 90.4908 1613.5 90.4908ZM1573 129.5C1573 107.132 1591.13 89 1613.5 89C1635.87 89 1654 107.132 1654 129.5C1654 151.868 1635.87 170 1613.5 170C1591.13 170 1573 151.868 1573 129.5Z"
                        fill="#19232F"
                    />
                </g>
            </g>
            <defs>
                <radialGradient
                    id="paintCI0_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(1604.68 144.221) rotate(31.608) scale(333 194)"
                >
                    <stop stop-color="#19232F" />
                    <stop offset="1" stop-color="#19232F" stop-opacity="0" />
                </radialGradient>
                <radialGradient
                    id="paintCI1_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(1163.4 129.923) rotate(-153.587) scale(333 194)"
                >
                    <stop stop-color="#F4F928" />
                    <stop offset="1" stop-color="#F4F928" stop-opacity="0" />
                </radialGradient>
                <radialGradient
                    id="paintCI2_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(1092.51 375.828) rotate(30) scale(333 194)"
                >
                    <stop stop-color="#657DA2" />
                    <stop offset="1" stop-color="#657DA2" stop-opacity="0" />
                </radialGradient>
            </defs>
        </svg>
    </div>
</template>
<script>
import { gsap } from 'gsap';
import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
gsap.registerPlugin(MotionPathPlugin);
export default {
    props: {
        links: {
            type: Array,
            required: true
        },
        selected: {
            type: String,
            required: true
        }
    },
    data: () => ({
        tweens: {},
        watcher: null
    }),
    watch: {
        selected(value, oldValue) {
            if (value) {
                this.slowMo(value);
            } else {
                this.resetSpeed(oldValue);
            }
        }
    },
    mounted() {
        this.$nextTick(() => {
            this.initPlanets();
        });
    },
    methods: {
        initPlanets() {
            this.links.forEach((planet, index) => {
                const id = planet.id;
                gsap.set(`#border_${id}`, {
                    scale: 0.25,
                    opacity: 0,
                    transformOrigin: '50% 50%'
                });
            });
        },
        slowMo(id) {
            gsap.killTweensOf([`#border_${id}`, `#circle_${id}`]);
            gsap.to(`#circle_${id}`, {
                duration: 0.5,
                scale: 2.6,
                transformOrigin: '50% 50%'
            });
            gsap.to(`#border_${id}`, {
                duration: 0.5,
                scale: 1,
                opacity: 1,
                transformOrigin: '50% 50%',
                delay: 0.1
            });
        },
        resetSpeed(id, index) {
            gsap.killTweensOf([`#border_${id}`, `#circle_${id}`]);

            gsap.to(`#circle_${id}`, {
                duration: 1,
                scale: 1,
                transformOrigin: '50% 50%'
            });
            gsap.to(`#border_${id}`, {
                duration: 0.5,
                scale: 0.25,
                transformOrigin: '50% 50%',
                opacity: 0
            });
        }
    }
};
</script>
