<template>
    <div ref="schema" class="schema">
        <svg width="2140" height="1028" viewBox="0 0 2140 1028" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="sustaperf">
                <rect width="2046" height="941" transform="translate(41 40)" fill="#657DA2" />
                <path
                    id="model_1"
                    d="M2044.23 713.829C2036.07 676.212 2012.64 637.908 1977.34 600.85C1942.03 563.789 1894.8 527.949 1838.98 495.261C1727.35 429.887 1581.29 377.097 1427.25 352.374C1273.22 327.651 1140.32 335.666 1049.97 368.654C1004.79 385.148 970.218 407.9 948.976 435.963C927.723 464.042 919.843 497.408 928.014 535.045C936.18 572.661 959.601 610.966 994.909 648.024C1030.22 685.085 1077.44 720.925 1133.26 753.612C1244.9 818.986 1390.96 871.777 1545 896.5C1699.03 921.222 1831.93 913.208 1922.28 880.22C1967.45 863.726 2002.03 840.974 2023.27 812.911C2044.52 784.832 2052.4 751.466 2044.23 713.829Z"
                    stroke="transparent"
                />
                <path
                    id="model_2"
                    d="M1203.86 501.876C1195.7 464.259 1172.28 425.954 1136.97 388.897C1101.66 351.835 1054.44 315.995 998.618 283.308C886.982 217.934 740.919 165.144 586.88 140.42C432.849 115.698 299.949 123.713 209.6 156.7C164.424 173.195 129.85 195.946 108.609 224.01C87.3561 252.089 79.476 285.455 87.6464 323.091C95.8126 360.708 119.234 399.013 154.541 436.071C189.852 473.132 237.075 508.972 292.893 541.659C404.528 607.033 550.592 659.824 704.63 684.547C858.662 709.269 991.562 701.255 1081.91 668.267C1127.09 651.773 1161.66 629.021 1182.9 600.958C1204.15 572.878 1212.03 539.512 1203.86 501.876Z"
                    stroke="transparent"
                />
                <path
                    v-for="planet in planets"
                    :id="`trail_${planet.id}`"
                    :key="`trail_${planet.id}`"
                    d="M1656 844H1323V456H1656V844Z"
                    :fill="`url(#paint_vision_${planet.id}_radial)`"
                />
                <path
                    id="mask"
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2140 0H0V1028H2140V0ZM209.428 156.231C299.885 123.203 432.879 115.197 586.959 139.927C741.054 164.659 887.177 217.469 998.87 282.877C1036.88 305.138 1070.92 328.865 1099.93 353.449C1186.45 333.374 1299.65 331.387 1427.33 351.88C1581.42 376.612 1727.54 429.422 1839.24 494.83C1895.08 527.534 1942.35 563.401 1977.7 600.505C2013.04 637.601 2036.53 675.985 2044.72 713.723C2052.92 751.5 2045.01 785.015 2023.67 813.212C2002.35 841.378 1967.68 864.175 1922.45 880.69C1831.99 913.717 1699 921.724 1544.92 896.994C1390.82 872.261 1244.7 819.451 1133.01 754.043C1094.99 731.782 1060.96 708.056 1031.95 683.471C945.431 703.547 832.231 705.533 704.551 685.041C550.456 660.308 404.333 607.498 292.64 542.09C236.793 509.386 189.53 473.519 154.179 436.415C118.835 399.319 95.3502 360.935 87.1578 323.197C78.9568 285.42 86.8682 251.905 108.21 223.708C129.529 195.543 164.198 172.745 209.428 156.231ZM997.86 284.603C1035.3 306.529 1068.85 329.864 1097.51 354.018C1080.53 358.048 1064.59 362.781 1049.8 368.184C1004.57 384.698 969.896 407.496 948.578 435.661C927.235 463.858 919.324 497.373 927.525 535.151C935.717 572.888 959.202 611.272 994.546 648.369C1005.31 659.664 1017.17 670.844 1030.05 681.856C944.055 701.542 831.683 703.42 704.868 683.066C550.998 658.37 405.114 605.638 293.651 540.365C237.919 507.728 190.817 471.97 155.627 435.036C120.431 398.094 97.1996 360.027 89.1122 322.773C81.0334 285.559 88.8197 252.641 109.805 224.915C130.815 197.158 165.103 174.544 210.114 158.109C300.138 125.24 432.757 117.203 586.642 141.901C740.512 166.598 886.397 219.33 997.86 284.603ZM995.994 646.989C1007.02 658.56 1019.21 670.015 1032.47 681.295C1049.92 677.209 1066.26 672.385 1081.4 666.858C1126.41 650.424 1160.7 627.809 1181.71 600.052C1202.69 572.327 1210.48 539.409 1202.4 502.194C1194.31 464.94 1171.08 426.873 1135.88 389.931C1124.86 378.361 1112.67 366.906 1099.4 355.626C1081.96 359.711 1065.62 364.536 1050.48 370.063C1005.47 386.497 971.182 409.111 950.172 436.868C929.187 464.594 921.401 497.512 929.479 534.726C937.567 571.98 960.798 610.048 995.994 646.989ZM1082.08 668.736C1067.29 674.139 1051.35 678.872 1034.37 682.902C1063.03 707.056 1096.58 730.391 1134.02 752.318C1245.48 817.591 1391.37 870.323 1545.24 895.019C1699.12 919.718 1831.74 911.68 1921.76 878.811C1966.77 862.377 2001.06 839.763 2022.07 812.005C2043.06 784.28 2050.84 751.362 2042.77 714.147C2034.68 676.893 2011.45 638.826 1976.25 601.884C1941.06 564.95 1893.96 529.192 1838.23 496.556C1726.76 431.283 1580.88 378.551 1427.01 353.855C1300.19 333.501 1187.82 335.379 1101.83 355.065C1114.7 366.076 1126.57 377.257 1137.33 388.552C1172.68 425.648 1196.16 464.032 1204.35 501.77C1212.55 539.547 1204.64 573.062 1183.3 601.259C1161.98 629.425 1127.31 652.222 1082.08 668.736Z"
                    fill="#19232F"
                />
                <g v-for="planet in planets" :id="`circle_wrapper_${planet.id}`" :key="`circle_wrapper_${planet.id}`">
                    <circle :id="`circle${planet.id}`" cx="1322.5" cy="650.5" r="7.5" :fill="planet.color" />
                </g>
            </g>
            <defs>
                <radialGradient
                    v-for="planet in planets"
                    :id="`paint_vision_${planet.id}_radial`"
                    :key="`paint_vision_${planet.id}_radial`"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(708 412) rotate(-180) scale(333 194)"
                >
                    <stop :stop-color="planet.color" />
                    <stop offset="1" :stop-color="planet.color" stop-opacity="0" />
                </radialGradient>
            </defs>
        </svg>
    </div>
</template>

<script>
import { gsap } from 'gsap';
import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
gsap.registerPlugin(MotionPathPlugin);

export default {
    data: () => ({
        planets: [
            {
                id: 1,
                color: '#90F5CA'
            },
            {
                id: 2,
                color: '#F4F928'
            }
        ],
        tweens: [],
        watcher: null
    }),
    mounted() {
        this.$nextTick(() => {
            // this.setAppearInitialStyles();
            this.watcher = this.$stereorepo.superScroll
                .watch({
                    element: this.$refs.schema
                })
                .on('enter-view', () => {
                    this.play();
                })
                .on('leave-view', () => {
                    this.pause();
                });
            this.initPlanets();
            // this.appearAnimation();
        });
    },
    methods: {
        pause() {
            this.tweens.forEach(t => {
                t.pause();
            });
        },
        play() {
            this.tweens.forEach(t => {
                t.play();
            });
        },
        initPlanets() {
            this.planets.forEach((planet, index) => {
                const id = planet.id;
                const circleTween = gsap.to(`#circle_wrapper_${id}`, {
                    motionPath: {
                        path: `#model_${id}`,
                        align: `#model_${id}`,
                        alignOrigin: [0.5, 0.5],
                        autoRotate: true,
                        start: 0 + 0.5 * index,
                        end: 1 + 0.5 * index
                    },
                    duration: 5,
                    repeat: -1,
                    ease: 'none',
                    paused: true
                });
                const trailTween = gsap.to(`#trail_${id}`, {
                    motionPath: {
                        path: `#model_${id}`,
                        align: `#model_${id}`,
                        alignOrigin: [1, 0.5],
                        autoRotate: true,
                        start: 0 + 0.5 * index,
                        end: 1 + 0.5 * index
                    },
                    duration: 5,
                    repeat: -1,
                    ease: 'none',
                    paused: true
                });
                this.tweens.push(circleTween, trailTween);
            });
        }
    }
};
</script>
