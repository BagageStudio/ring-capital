<template>
    <div ref="schema" class="schema">
        <svg viewBox="0 0 2046 941" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="sustaperf">
                <rect width="2046" height="941" fill="#19232F" />
                <path
                    id="model_1"
                    opacity="0.4"
                    d="M2003.23 673.829C1995.07 636.212 1971.64 597.908 1936.34 560.85C1901.03 523.789 1853.8 487.949 1797.98 455.261C1686.35 389.887 1540.29 337.097 1386.25 312.374C1232.22 287.651 1099.32 295.666 1008.97 328.654C963.792 345.148 929.218 367.9 907.976 395.963C886.723 424.042 878.843 457.408 887.014 495.045C895.18 532.661 918.601 570.966 953.909 608.024C989.219 645.085 1036.44 680.925 1092.26 713.612C1203.9 778.986 1349.96 831.777 1504 856.5C1658.03 881.222 1790.93 873.208 1881.28 840.22C1926.45 823.726 1961.03 800.974 1982.27 772.911C2003.52 744.832 2011.4 711.466 2003.23 673.829Z"
                    stroke="black"
                />
                <path
                    id="model_2"
                    opacity="0.4"
                    d="M1162.86 461.876C1154.7 424.259 1131.28 385.954 1095.97 348.897C1060.66 311.835 1013.44 275.995 957.618 243.308C845.982 177.934 699.919 125.144 545.88 100.42C391.849 75.6983 258.949 83.7125 168.6 116.7C123.424 133.195 88.8503 155.946 67.6092 184.01C46.3561 212.089 38.476 245.455 46.6464 283.091C54.8126 320.708 78.2341 359.013 113.541 396.071C148.852 433.132 196.075 468.972 251.893 501.659C363.528 567.033 509.592 619.824 663.63 644.547C817.662 669.269 950.562 661.255 1040.91 628.267C1086.09 611.773 1120.66 589.021 1141.9 560.958C1163.15 532.878 1171.03 499.512 1162.86 461.876Z"
                    stroke="black"
                />
                <g id="Mask Group">
                    <mask
                        id="mask0"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="883"
                        y="297"
                        width="1124"
                        height="575"
                    >
                        <path
                            id="path_1_mask"
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M1008.8 328.184C1099.25 295.156 1232.25 287.15 1386.33 311.88C1540.42 336.612 1686.54 389.422 1798.24 454.83C1854.08 487.534 1901.35 523.401 1936.7 560.505C1972.04 597.601 1995.53 635.985 2003.72 673.723C2011.92 711.5 2004.01 745.015 1982.67 773.212C1961.35 801.378 1926.68 824.175 1881.45 840.69C1790.99 873.717 1658 881.724 1503.92 856.994C1349.82 832.261 1203.7 779.451 1092.01 714.043C1036.16 681.339 988.897 645.472 953.546 608.369C918.202 571.272 894.717 532.888 886.525 495.151C878.324 457.373 886.235 423.858 907.578 395.661C928.896 367.496 963.565 344.698 1008.8 328.184ZM909.172 396.868C888.187 424.594 880.401 457.512 888.479 494.726C896.567 531.98 919.798 570.048 954.994 606.989C990.184 643.923 1037.29 679.681 1093.02 712.318C1204.48 777.591 1350.37 830.323 1504.24 855.019C1658.12 879.718 1790.74 871.68 1880.76 838.811C1925.77 822.377 1960.06 799.763 1981.07 772.005C2002.06 744.28 2009.84 711.362 2001.77 674.147C1993.68 636.893 1970.45 598.826 1935.25 561.884C1900.06 524.95 1852.96 489.192 1797.23 456.556C1685.76 391.283 1539.88 338.551 1386.01 313.855C1232.12 289.156 1099.51 297.193 1009.48 330.063C964.471 346.497 930.182 369.111 909.172 396.868Z"
                            fill="#657DA2"
                        />
                    </mask>
                    <g mask="url(#mask0)">
                        <rect id="path_1_bg" opacity="0.4" x="883" y="297" width="1124" height="574" fill="#657DA2" />
                        <path id="trail_1" d="M1615 804H1282V416H1615V804Z" fill="url(#paint0_radial)" />
                    </g>
                </g>
                <g id="path_2">
                    <mask
                        id="mask1"
                        mask-type="alpha"
                        maskUnits="userSpaceOnUse"
                        x="42"
                        y="85"
                        width="1125"
                        height="575"
                    >
                        <path
                            id="path_2_mask"
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M168.428 116.231C258.885 83.2033 391.879 75.1968 545.959 99.9267C700.054 124.659 846.177 177.469 957.87 242.877C1013.72 275.581 1060.98 311.448 1096.33 348.552C1131.68 385.648 1155.16 424.032 1163.35 461.77C1171.55 499.547 1163.64 533.062 1142.3 561.259C1120.98 589.425 1086.31 612.222 1041.08 628.736C950.625 661.764 817.631 669.77 663.551 645.041C509.456 620.308 363.333 567.498 251.64 502.09C195.793 469.386 148.53 433.519 113.179 396.415C77.8351 359.319 54.3502 320.935 46.1578 283.197C37.9568 245.42 45.8682 211.905 67.2105 183.708C88.5288 155.543 123.198 132.745 168.428 116.231ZM68.8052 184.915C47.8197 212.641 40.0334 245.559 48.1122 282.773C56.1996 320.027 79.4308 358.094 114.627 395.036C149.817 431.97 196.919 467.728 252.651 500.365C364.114 565.638 509.998 618.37 663.868 643.066C817.753 667.764 950.372 659.727 1040.4 626.858C1085.41 610.424 1119.7 587.809 1140.71 560.052C1161.69 532.327 1169.48 499.409 1161.4 462.194C1153.31 424.94 1130.08 386.873 1094.88 349.931C1059.69 312.997 1012.59 277.239 956.86 244.603C845.397 179.33 699.512 126.598 545.642 101.901C391.757 77.2028 259.138 85.2401 169.114 118.109C124.103 134.544 89.8146 157.158 68.8052 184.915Z"
                            fill="#657DA2"
                        />
                    </mask>
                    <g mask="url(#mask1)">
                        <rect id="path_2_bg" opacity="0.4" x="43" y="85" width="1124" height="574" fill="#657DA2" />
                        <path id="trail_2" d="M726 565H393V177H726V565Z" fill="url(#paint1_radial)" />
                    </g>
                </g>
                <g id="circle_wrapper_1">
                    <circle id="circle_2" cx="1208.5" cy="770.5" r="7.5" fill="#90F5CA" />
                </g>
                <g id="circle_wrapper_2">
                    <circle id="circle_2_2" cx="756.5" cy="153.5" r="7.5" fill="#F4F928" />
                </g>
            </g>
            <defs>
                <radialGradient
                    id="paint0_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(1615 610) rotate(-180) scale(333 194)"
                >
                    <stop stop-color="#90F5CA" />
                    <stop offset="1" stop-color="#90F5CA" stop-opacity="0" />
                </radialGradient>
                <radialGradient
                    id="paint1_radial"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(726 371) rotate(-180) scale(333 194)"
                >
                    <stop stop-color="#F4F928" />
                    <stop offset="1" stop-color="#F4F928" stop-opacity="0" />
                </radialGradient>
            </defs>
        </svg>
    </div>
</template>

<script>
import { gsap } from 'gsap';
import { MotionPathPlugin } from 'gsap/MotionPathPlugin';
gsap.registerPlugin(MotionPathPlugin);

export default {
    data: () => ({
        planets: [
            {
                id: 1,
                color: '#90F5CA'
            },
            {
                id: 2,
                color: '#F4F928'
            }
        ],
        tweens: [],
        progressProxy: 0,
        watcher: null
    }),
    mounted() {
        this.$nextTick(() => {
            this.watcher = this.$stereorepo.superScroll
                .watch({
                    element: this.$refs.schema
                })
                .on('enter-view', () => {
                    this.play();
                })
                .on('leave-view', () => {
                    this.pause();
                });
            this.initPlanets();
        });
    },
    beforeDestroy() {
        if (this.watcher) this.watcher.forget();
        this.pause();
    },
    methods: {
        pause() {
            this.tweens.forEach(t => {
                t.pause();
            });
        },
        play() {
            gsap.to(this, {
                duration: 7,
                progressProxy: 1.333,
                ease: 'power2.out',
                onUpdate: () => {
                    gsap.set(this.tweens, {
                        progress: this.progressProxy % 1
                    });
                }
            });
        },
        initPlanets() {
            const circle2 = gsap.to('#circle_wrapper_2', {
                motionPath: {
                    path: '#model_2',
                    align: '#model_2',
                    alignOrigin: [0.5, 0.5],
                    start: 0.5001,
                    end: 1.5
                },
                paused: true,
                immediateRender: true,
                duration: 7,
                ease: 'none'
            });
            const trail2 = gsap.to('#trail_2', {
                motionPath: {
                    path: '#model_2',
                    align: '#model_2',
                    alignOrigin: [1, 0.5],
                    autoRotate: true,
                    start: 0.5001,
                    end: 1.5
                },
                paused: true,
                immediateRender: true,
                duration: 7,
                ease: 'none'
            });
            const circle1 = gsap.to('#circle_wrapper_1', {
                motionPath: {
                    path: '#model_1',
                    align: '#model_1',
                    alignOrigin: [0.5, 0.5]
                },
                paused: true,
                immediateRender: true,
                duration: 7,
                ease: 'none'
            });
            const trail1 = gsap.to('#trail_1', {
                motionPath: {
                    path: '#model_1',
                    align: '#model_1',
                    alignOrigin: [1, 0.5],
                    autoRotate: true
                },
                paused: true,
                immediateRender: true,
                duration: 7,
                ease: 'none'
            });
            // this.tweens.push(circle1, trail1);
            this.tweens.push(circle1, circle2, trail1, trail2);
        }
    }
};
</script>
<style lang="scss" scoped>
path {
    backface-visibility: hidden;
    transform-style: preserve-3d;
}
</style>
